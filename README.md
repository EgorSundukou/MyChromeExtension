# AutoDeclineFB — Описание и принцип работы

**AutoDeclineFB** — это расширение для браузера Chrome, предназначенное для автоматизации отклонения или удаления запросов/публикаций в группах Facebook.

---

## Как это работает (Принцип работы)

Расширение работает в циклическом режиме, имитируя действия реального пользователя. Оно сканирует содержимое страницы на наличие кнопок с ключевыми словами («Decline», «Remove», «Отклонить» и т. д.) и выполняет по ним клики.

### Основные компоненты системы:
1.  **Popup (Попап)**: Управляющий интерфейс. Позволяет запускать/останавливать скрипт и проверять его текущий статус.
2.  **Background Script (Фоновый скрипт)**: Работает в фоновом режиме, поддерживает активность расширения и периодически «пингует» вкладки Facebook, чтобы убедиться, что основной алгоритм не остановился.
3.  **Content Script (Контентный скрипт)**: Сердце приложения. Внедряется непосредственно в страницу Facebook. Находит кнопки, управляет прокруткой и выполняет клики.

---

## Пошаговая логика работы

### 1. Запуск
При нажатии кнопки **«Запустить скрипт»** в попапе, расширение сохраняет флаг автозапуска в изолированном хранилище браузера (`chrome.storage.local`), привязанном к конкретной вкладке (через Tab ID). Это гарантирует, что сессии в разных вкладках не пересекаются. После перезагрузки страницы скрипт считывает свой статус и автоматически продолжает работу.

### 2. Поиск и нажатие кнопок
Скрипт ищет элементы (кнопки, ссылки), текст которых совпадает с заданными паттернами. Для надёжности используется **трехэтапная стратегия клика**:
*   **Этап 1**: Симуляция стандартных событий мыши (`mouseover` -> `mousedown` -> `click`).
*   **Этап 2**: Использование `PointerEvents` для обхода некоторых защит.
*   **Этап 3**: Поиск элемента по координатам (`elementFromPoint`), если кнопка перекрыта другими элементами.

**Верификация**: После каждого клика скрипт проверяет, исчезла ли кнопка или изменился ли её текст. Только после успешного подтверждения элемент помечается как обработанный.

### 3. Навигация и прокрутка
Если на видимой части страницы кнопок нет, скрипт начинает **прогрессивную прокрутку**:
*   Сначала делаются короткие шаги (по 25% высоты экрана) для подгрузки контента.
*   Если контент всё равно не появился, выполняется прокрутка на целую страницу.
*   **Soft Recovery (Мягкое восстановление)**: Если кнопки не найдены после всех попыток прокрутки, скрипт пробует немного прокрутить страницу вверх-вниз, чтобы спровоцировать «ленивую загрузку» элементов Facebook.

### 4. Обработка простоев и ошибок
*   **Reload (Перезагрузка)**: Если скрипт долгое время не находит кнопок или сталкивается с серией ошибок клика, он автоматически перезагружает страницу, чтобы сбросить состояние интерфейса Facebook и начать заново.
*   **Heartbeat (Пульс)**: Чтобы браузер не усыплял вкладку во время долгой работы, скрипт выполняет микро-движения, поддерживая её активной.

---

## Инструкция по использованию
1.  Откройте нужную группу в Facebook (страницу с запросами на вступление или публикациями).
2.  Нажмите на иконку расширения и выберите **«Запустить скрипт»**.
3.  Для остановки нажмите **«Остановить скрипт»**.
4.  Вы можете проверить, работает ли скрипт в данный момент, нажав **«Проверить статус»**.

---

*Документ создан на основе Implementation Plan расширения.*
